#########
Xenon CPU
#########

Supported SPRs
==============

+---------+-------+--------------------+--------------------+--------------------+
| Decimal | Hex   | Name               | Description        | Documented In      |
+=========+=======+====================+====================+====================+
| 8       | 0x008 | LR                 |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 18      | 0x012 | DSISR              |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 19      | 0x013 | DAR                |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 26      | 0x01a | SRR0               |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 27      | 0x01b | SRR1               |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 152     | 0x098 | CTRL               |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 272     | 0x110 | SPRG0              |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 287     | 0x11f | PVR                |                    |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 304     | 0x130 | HSPRG0             | Hypervisor         | Power ISA v2.06    |
|         |       |                    | Software-use SPR 0 |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 305     | 0x131 | HSPRG1             | Hypervisor         | Power ISA v2.06    |
|         |       |                    | Software-use SPR 1 |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 318     | 0x13e | LPCR               | Logical            | Power ISA v2.06    |
|         |       |                    | Partitioning       |                    |
|         |       |                    | Control Register   |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 921     | 0x399 | TSCR               | Thread Switch      | POWER8/9 Processor |
|         |       |                    | Control Register   | User’s Manual      |
+---------+-------+--------------------+--------------------+--------------------+
| 922     | 0x39a | TTR                | Thread Time-Out    | POWER8/9 Processor |
|         |       |                    | Register           | User’s Manual      |
+---------+-------+--------------------+--------------------+--------------------+
| 946     | 0x3b2 | PPE_TLB_Index_Hint |                    | CBE Public         |
|         |       |                    |                    | Registers          |
+---------+-------+--------------------+--------------------+--------------------+
| 947     | 0x3b3 | PPE_TLB_Index      |                    | CBE Public         |
|         |       |                    |                    | Registers          |
+---------+-------+--------------------+--------------------+--------------------+
| 948     | 0x3b4 | PPE_TLB_VPN        |                    | CBE Public         |
|         |       |                    |                    | Registers          |
+---------+-------+--------------------+--------------------+--------------------+
| 949     | 0x3b5 | PPE_TLB_RPN        |                    | CBE Public         |
|         |       |                    |                    | Registers          |
+---------+-------+--------------------+--------------------+--------------------+
| 1009    | 0x3f1 | HID1               | Hardware           | CBE Public         |
|         |       |                    | Implementation     | Registers          |
|         |       |                    | Dependent 1        |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 1013    | 0x3f5 | DABR               | Data Address       | PowerPC 970FX UM   |
|         |       |                    | Breakpoint         |                    |
|         |       |                    | Register           |                    |
+---------+-------+--------------------+--------------------+--------------------+
| 1017    | 0x3f9 | HID6               |                    | CBE Public         |
|         |       |                    |                    | Registers          |
+---------+-------+--------------------+--------------------+--------------------+

HID1
----

HV enables instruction caching & prefetch by setting:

* en_icway = 0b11
* en_i_prefetch = 0b1

HID6
----

CBB enables time-base facility by setting:

* (TBR = 0x1ff)
* HID6.tb_enable = 0b1

Also sets: HID6.RMSC = 0b1110

SOC MMIO Registers
==================

+----------------------+-------+---------------+-----------------------+
| Address              | Width | Register      | Description           |
+======================+=======+===============+=======================+
| 0x020000030000+0x020 |       |               | CBB writes            |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x008 |       | ???           | Referenced in 1BL     |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x010 | u64   | POST_OUT      | 8 bits MSB are output |
|                      |       |               | on the CPU_DEBUG pins |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x050 | u64   |               |                       |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x060 | u64   |               |                       |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x188 | u64   |               | Controls clock        |
|                      |       |               | divisor & VID         |
+----------------------+-------+---------------+-----------------------+
| 0x020000061000+0x1a0 | u64   | TBR           | CBB writes            |
+----------------------+-------+---------------+-----------------------+

TBR
-------------

Controls the rate at which the BookE time-base (TBU / TBL) gets incremented:

* 0 stops the timer
* CBB/XeLL writes 0x1ff to start the timer

Note that the time-base is counted per-thread, so XeLL LV2 syncs the time-bases of all threads:

* Stop time-base timer (TBR <- 0)
* Catch all threads. In all threads, execute:

  * TBLW <- 0
  * TBUW <- 0
  * TBLW <- 0 (TODO: why repeat TBLW write?)

* Restart the time-base timer (TBR <- 0x0ff)

Potentially same as CellBE TBR register, thus:

* 0x100 = Timebase_mode
* 0x0ff = Timebase_setting

POST_OUT
--------------

+----------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
| 63       | 62 | 61 | 60 | 59 | 58 | 57 | 56 | 55 | 54 | 53 | 52 | 51 | 50 | 49 | 48 | 47 | 46 | 45 | 44 | 43 | 42 | 41 | 40 | 39 | 38 | 37 | 36 | 35 | 34 | 33 | 32 |
+==========+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+
| POST_OUT                                    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |
+----------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
| 31       | 30 | 29 | 28 | 27 | 26 | 25 | 24 | 23 | 22 | 21 | 20 | 19 | 18 | 17 | 16 | 15 | 14 | 13 | 12 | 11 | 10 | 9  | 8  | 7  | 6  | 5  | 4  | 3  | 2  | 1  | 0  |
+----------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
|          |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |
+----------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+

0x188 register
--------------

+-----------------+-----------------+--------+----------+-----------+----+----+----+----+--------------+-----------+----+----+----+----+----+--------+----------+----+----+----+----+----+----+----+----+----+----+--------------+----+----+----+
| 63              | 62              | 61     | 60       | 59        | 58 | 57 | 56 | 55 | 54           | 53        | 52 | 51 | 50 | 49 | 48 | 47     | 46       | 45 | 44 | 43 | 42 | 41 | 40 | 39 | 38 | 37 | 36 | 35           | 34 | 33 | 32 |
+=================+=================+========+==========+===========+====+====+====+====+==============+===========+====+====+====+====+====+========+==========+====+====+====+====+====+====+====+====+====+====+==============+====+====+====+
|                 |                 |        |          |           |    |    |    |    |              | VID_FUSED                          |        |          |    |    |    |    |    |    |    |    |    |    |              |    |    |    |
+-----------------+-----------------+--------+----------+-----------+----+----+----+----+--------------+-----------+----+----+----+----+----+--------+----------+----+----+----+----+----+----+----+----+----+----+--------------+----+----+----+
| 31              | 30              | 29     | 28       | 27        | 26 | 25 | 24 | 23 | 22           | 21        | 20 | 19 | 18 | 17 | 16 | 15     | 14       | 13 | 12 | 11 | 10 | 9  | 8  | 7  | 6  | 5  | 4  | 3            | 2  | 1  | 0  |
+-----------------+-----------------+--------+----------+-----------+----+----+----+----+--------------+-----------+----+----+----+----+----+--------+----------+----+----+----+----+----+----+----+----+----+----+--------------+----+----+----+
| 0xFF when setting VID                                                            | 0xFF when setting CLK_DIV                              | LOCKED | VID_PROG | VID_FINAL                   |    |    |    |    | CLK_DIV_PROG | CLK_DIV      |
+-----------------+-----------------+--------+----------+-----------+----+----+----+----+--------------+-----------+----+----+----+----+----+--------+----------+----+----+----+----+----+----+----+----+----+----+--------------+----+----+----+
